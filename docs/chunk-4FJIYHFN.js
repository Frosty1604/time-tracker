import{E as _e,G as we,H as ye}from"./chunk-DEEZGI7K.js";import{Ab as ce,B as K,Cc as me,Eb as E,F as Y,Gb as I,H as Z,I as q,Ie as Se,Pb as le,Pd as de,Qb as h,Rb as ue,Rd as ve,T as Q,Td as he,Ub as se,Wa as U,_ as ee,a as D,ba as te,ca as T,cc as pe,dc as fe,ga as re,ib as ie,j as N,kb as ae,ne as xe,oe as be,pa as R,pb as oe,ra as ne,ub as f,v as m,vb as d,wa as g,xa as j}from"./chunk-6OML64PC.js";function v(t){return Object.prototype.toString.call(t)==="[object Array]"}function M(t,n){if(!t)throw new Error(n)}function F(t){return Object.keys(t)}function w(t){return Object.keys(t).map(function(n){return[n,t[n]]})}function b(t,n,i){var e="."+n,r=new RegExp("(\\".concat(n,")?$"));return i(t).replace(r,e)}function ge(t){return"555xmlHello .  world!".trim().replace(/^([0-9,;]|(xml))+/,""),t.replace(/[^_a-zA-Z 0-9:\-\.]/g,"").replace(/^([ 0-9-:\-\.]|(xml))+/i,"").replace(/ +/g,"-")}function je(t){return Array(t+1).join(" ")}function Ee(t){return t.replace(/([<>&])/g,function(n,i){switch(i){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";default:return""}})}function Pe(t,n,i){switch(n){case"txt":{var e="text/plain;charset=utf-8";return i?URL.createObjectURL(new Blob([t],{type:e})):"data:,".concat(e)+encodeURIComponent(t)}case"css":{var e="text/css;charset=utf-8";return i?URL.createObjectURL(new Blob([t],{type:e})):"data:,".concat(e)+encodeURIComponent(t)}case"html":{var e="text/html;charset=utf-8";return i?URL.createObjectURL(new Blob([t],{type:e})):"data:,".concat(e)+encodeURIComponent(t)}case"json":{var e="text/json;charset=utf-8";return i?URL.createObjectURL(new Blob([t],{type:e})):"data:,".concat(e)+encodeURIComponent(t)}case"csv":{var e="text/csv;charset=utf-8";return i?URL.createObjectURL(new Blob([t],{type:e})):"data:,".concat(e)+encodeURIComponent(t)}case"xls":{var e="text/application/vnd.ms-excel;charset=utf-8";return i?URL.createObjectURL(new Blob([t],{type:e})):"data:,".concat(e)+encodeURIComponent(t)}case"xml":{var e="text/application/xml;charset=utf-8";return i?URL.createObjectURL(new Blob([t],{type:e})):"data:,".concat(e)+encodeURIComponent(t)}default:return""}}function A(t,n,i,e){i===void 0&&(i="download"),e===void 0&&(e=!0);var r=Pe(t,n,e),a=document.createElement("a");a.href=r,a.download=i,a.setAttribute("style","visibility:hidden"),document.body.appendChild(a),a.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!1,view:window})),document.body.removeChild(a)}var x=function(){return x=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++){n=arguments[i];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},x.apply(this,arguments)},O=function(t,n){var i=typeof Symbol=="function"&&t[Symbol.iterator];if(!i)return t;var e=i.call(t),r,a=[],o;try{for(;(n===void 0||n-- >0)&&!(r=e.next()).done;)a.push(r.value)}catch(c){o={error:c}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(o)throw o.error}}return a};function Me(t){if(!t||v(t)&&!t.length||!v(t)&&!F(t).length)return function(i){return i};var n=v(t)?t.reduce(function(i,e){var r;return x(x({},i),(r={},r[e]=e,r))},Object.create(null)):t;return function(i){return v(i)?i.map(function(e){return w(e).reduce(function(r,a){var o=O(a,2),c=o[0],l=o[1];return c in n&&(r[n[c]]=l),r},Object.create(null))}).filter(function(e){return F(e).length}):w(i).reduce(function(e,r){var a=O(r,2),o=a[0],c=a[1];return o in n&&(e[n[o]]=c),e},Object.create(null))}}function Oe(t){var n="Invalid export data. Please provide a valid JSON";try{return typeof t=="string"?JSON.parse(t):t}catch{throw new Error(n)}}function Ce(t,n,i){n===void 0&&(n=null);var e="Invalid export data. Please provide valid JSON object";try{return JSON.stringify(t,n,i)}catch{throw new Error(e)}}function Ne(t){return t.map(w).reduce(function(n,i,e){return i.reduce(function(r,a){var o=O(a,2),c=o[0],l=o[1],u=r[c]||Array.from({length:t.length}).map(function(s){return""});return u[e]=(typeof l!="string"?JSON.stringify(l):l)||"",r[c]=u,r},n)},Object.create(null))}function Te(t,n){return n===void 0&&(n=function(i){return i}),n(w(t).map(function(i){var e=O(i,2),r=e[0],a=e[1];return{fieldName:r,fieldValues:a}}))}function Xe(t,n){var i=new RegExp("".concat(n,`|"|
`)),e=i.test(t)?'"':"",r=t.replace(/"/g,'""');return"".concat(e).concat(r).concat(e)}var ze={beforeTableEncode:function(t){return t},delimiter:","};function Ie(t,n){n===void 0&&(n={});var i=x(x({},ze),n),e=i.beforeTableEncode,r=i.delimiter;if(!t.length)return"";var a=Ne(t),o=Te(a,e),c=o.map(function(s){var p=s.fieldName;return p}).join(r)+`\r
`,l=o.map(function(s){var p=s.fieldValues;return p}).map(function(s){return s.map(function(p){return Xe(p,r)})}),u=l.reduce(function(s,p){return s.map(function(C,L){return"".concat(C).concat(r).concat(p[L])})});return c+u.join(`\r
`)}function Ge(t,n){M(t.length>0);var i=Ne(t),e=Te(i,n),r=e.map(function(c){var l=c.fieldName;return l}).join("</b></th><th><b>"),a=e.map(function(c){var l=c.fieldValues;return l}).map(function(c){return c.map(function(l){return"<td>".concat(l,"</td>")})}),o=a.reduce(function(c,l){return c.map(function(u,s){return"".concat(u).concat(l[s])})});return`
    <table>
      <thead>
        <tr><th><b>`.concat(r,`</b></th></tr>
      </thead>
      <tbody>
        <tr>`).concat(o.join(`</tr>
        <tr>`),`</tr>
      </tbody>
    </table>
  `)}var We={beforeTableEncode:function(t){return t}};function Le(t,n){var i=x(x({},We),n).beforeTableEncode;if(!t.length)return"";var e=`<html>
  <head>
    <meta charset="UTF-8" />
  </head >
  <body>
    `.concat(Ge(t,i),`
  </body>
</html >
`);return e}function ke(t){var n=`<?xml version="1.0" encoding="utf-8"?><!DOCTYPE base>
`.concat(V(t,"base"),`
`);return n}function V(t,n,i,e){i===void 0&&(i="element"),e===void 0&&(e=0);var r=ge(n),a=je(e);if(t==null)return"".concat(a,"<").concat(r," />");var o=v(t)?t.map(function(l){return V(l,i,i,e+2)}).join(`
`):typeof t=="object"?w(t).map(function(l){var u=O(l,2),s=u[0],p=u[1];return V(p,s,i,e+2)}).join(`
`):a+"  "+Ee(String(t)),c="".concat(a,"<").concat(r,`>
`).concat(o,`
`).concat(a,"</").concat(r,">");return c}var De={txt:"txt",css:"css",html:"html",json:"json",csv:"csv",xls:"xls",xml:"xml"};function J(t){var n=t.data,i=t.fileName,e=i===void 0?"download":i,r=t.extension,a=t.fileNameFormatter,o=a===void 0?function(k){return k.replace(/\s+/,"_")}:a,c=t.fields,l=t.exportType,u=l===void 0?"txt":l,s=t.replacer,p=s===void 0?null:s,C=t.space,L=C===void 0?4:C,$=t.processor,_=$===void 0?A:$,B=t.withBOM,Fe=B===void 0?!1:B,P=t.beforeTableEncode,X=P===void 0?function(k){return k}:P,z=t.delimiter,Ae=z===void 0?",":z,G="Invalid export data. Please provide an array of objects",Ve="Can't export unknown data type ".concat(u,"."),Je="Can't export string data to ".concat(u,".");if(typeof n=="string")switch(u){case"txt":case"css":case"html":return _(n,u,b(e,r??u,o));default:throw new Error(Je)}var $e=Me(c),S=$e(Oe(n)),W=Ce(S,p,L);switch(u){case"txt":case"css":case"html":return _(W,u,b(e,r??u,o));case"json":return _(W,u,b(e,r??"json",o));case"csv":{M(v(S),G);var Be="\uFEFF",H=Ie(S,{beforeTableEncode:X,delimiter:Ae}),y=Fe?Be+H:H;return _(y,u,b(e,r??"csv",o))}case"xls":{M(v(S),G);var y=Le(S,{beforeTableEncode:X});return _(y,u,b(e,r??"xls",o))}case"xml":{var y=ke(S);return _(y,u,b(e,r??"xml",o))}default:throw new Error(Ve)}}J.types=De;J.processors={downloadFile:A};var Re=J;var Ue=Re;function He(t,n){if(t&1){let i=ce();f(0,"div",1)(1,"div")(2,"h3",2),h(3,"Export"),d(),f(4,"p",3),h(5,"Save your data into a JSON file and download it."),d(),f(6,"button",4),E("click",function(){g(i);let r=I();return j(r.exportData())}),h(7," Export "),d()(),f(8,"div")(9,"h3",5),h(10,"Import"),d(),f(11,"input",6,7),E("change",function(r){g(i);let a=I();return j(a.handleFileChange(r))}),d(),f(13,"div",8)(14,"span",9),h(15),d(),f(16,"button",10),E("click",function(){g(i);let r=le(12);return j(r.click())}),f(17,"mat-icon"),h(18,"upload_file"),d()()(),f(19,"button",11),E("click",function(){g(i);let r=I();return j(r.importData())}),h(20," Import "),d()()()}t&2&&(U(15),ue(n.fileName||"Choose file"),U(4),ae("disabled",n.disableImport))}var yt=(()=>{let n=class n{constructor(){this.snackbarService=R(we),this.workTimeService=R(Se),this.exportSubject=new N,this.fileSubject=new N,this.importSubject=new N,this.fileName$=this.fileSubject.pipe(m(e=>e?.name??"")),this.disableImport$=this.fileSubject.pipe(m(e=>e==null),te(!0)),this.export$=this.exportSubject.asObservable().pipe(T(()=>this.workTimeService.find()),m(e=>this.export(e))),this.import$=q([this.importSubject,this.fileSubject.pipe(Z(e=>e!=null))]).pipe(T(([,e])=>e.text()),T(e=>this.parseJson(e)),Q(e=>K(e.map(r=>(delete r.id,r.date=new Date(r.date),this.workTimeService.insert(r))))),m(e=>e.length),re(e=>{this.snackbarService.open(`Imported ${e} entries successfully`)})),this.viewModel$=Y(this.fileName$.pipe(m(e=>({fileName:e}))),this.disableImport$.pipe(m(e=>({disableImport:e}))),this.export$.pipe(m(()=>({}))),this.import$.pipe(m(()=>({fileName:"",disableImport:!0})))).pipe(ee((e,r)=>D(D({},e),r),{disableImport:!0,fileName:""}))}exportData(){this.exportSubject.next()}importData(){this.importSubject.next()}handleFileChange(e){let r=e.target.files?.[0];r&&this.fileSubject.next(r)}export(e){Ue({data:e,fileName:"timetracker-db",exportType:"json",fileNameFormatter:r=>`${new Date().toLocaleDateString()}-${r}`})}parseJson(e){return new Promise((r,a)=>{try{let o=JSON.parse(e);r(o)}catch(o){o instanceof Error&&this.snackbarService.open(o.message,"Dismiss"),a(o)}})}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=ne({type:n,selectors:[["ng-component"]],standalone:!0,features:[se],decls:2,vars:3,consts:[["class","flex flex-col gap-4"],[1,"flex","flex-col","gap-4"],[1,"text-lg","mb-4"],[1,"mb-2"],["mat-raised-button","","color","primary",3,"click"],[1,"text-lg","my-4"],["type","file",1,"hidden",3,"change"],["fileUpload",""],[1,"my-2"],[1,"mr-2"],["mat-mini-fab","","color","accent",3,"click"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(r,a){if(r&1&&(ie(0,He,21,2,"div",0),pe(1,"async")),r&2){let o;oe(0,(o=fe(1,1,a.viewModel$))?0:-1,o)}},dependencies:[he,de,ve,_e,be,xe,ye,me],encapsulation:2,changeDetection:0});let t=n;return t})();export{yt as BackupComponent};
